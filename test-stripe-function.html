<!DOCTYPE html>
<html>
<head>
    <title>Test Stripe Function</title>
</head>
<body>
    <h1>Stripe Function Test</h1>
    <button onclick="testStripeFunction()">Test Stripe Connection</button>
    <button onclick="testCreatePaymentIntent()">Test Create Payment Intent</button>
    <div id="results"></div>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        const supabase = window.supabase.createClient(
            'https://kqshrevhtrusxrwkgdmd.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtxc2hyZXZodHJ1c3hyd2tnZG1kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2ODQ0NDcsImV4cCI6MjA3NDI2MDQ0N30.797cTDtt67n9rtpSjOGOawf6od5ETfcfbAftiR3qkJs'
        );

        async function testStripeFunction() {
            const results = document.getElementById('results');
            results.innerHTML = '<p>Testing Stripe connection...</p>';

            try {
                const { data, error } = await supabase.functions.invoke('test-stripe', {
                    body: {}
                });

                console.log('Test Stripe Response:', { data, error });

                if (error) {
                    results.innerHTML = `<p style="color: red;">❌ Error: ${JSON.stringify(error, null, 2)}</p>`;
                } else {
                    results.innerHTML = `<p style="color: green;">✅ Success: ${JSON.stringify(data, null, 2)}</p>`;
                }
            } catch (error) {
                console.error('Test error:', error);
                results.innerHTML = `<p style="color: red;">❌ Exception: ${error.message}</p>`;
            }
        }

        async function testCreatePaymentIntent() {
            const results = document.getElementById('results');
            results.innerHTML = '<p>Testing payment intent creation...</p>';

            try {
                const testData = {
                    amount: 5000, // $50.00 AUD
                    currency: 'aud',
                    session_id: 'test-session-' + Date.now(),
                    customer_details: {
                        email: 'test@example.com',
                        name: 'Test Customer',
                        phone: '+61400000000',
                        address: {
                            line1: '123 Test St',
                            line2: '',
                            city: 'Sydney',
                            state: 'NSW',
                            postalCode: '2000',
                            country: 'AU'
                        }
                    },
                    cart_items: [
                        {
                            productId: 'test-product',
                            name: 'Test Product',
                            quantity: 1,
                            price: 50.00
                        }
                    ],
                    order_summary: {
                        subtotal: 50.00,
                        shipping: 0,
                        tax: 0,
                        total: 50.00
                    }
                };

                const { data, error } = await supabase.functions.invoke('create-payment-intent', {
                    body: testData
                });

                console.log('Payment Intent Response:', { data, error });

                if (error) {
                    results.innerHTML = `<p style="color: red;">❌ Error: ${JSON.stringify(error, null, 2)}</p>`;
                } else {
                    results.innerHTML = `<p style="color: green;">✅ Success: ${JSON.stringify(data, null, 2)}</p>`;
                }
            } catch (error) {
                console.error('Payment intent test error:', error);
                results.innerHTML = `<p style="color: red;">❌ Exception: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>